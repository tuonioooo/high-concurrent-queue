# 持久化机制

### 背景

场景问题：服务器断电重启，未被消费的消息是否会在重启之后被继续消费？ 两种选择：非持久性模式/持久性模式

**非持久性模式：**

`服务器断电(关闭)之后，使用非持久性模式时，没有被消费的消息不会继续消费全部丢失；` 程序会报一个连接关闭异常停止运行，继续启动服务器运行程序，不会接收任何消息。

**持久性模式：**

`服务器断电(关闭)后，使用持久性模式时，没有被消费的消息会继续消费；` 程序也会报连接关闭异常，但再次启动服务器和程序后，接收方还能继续原来的消息再次接收。

### ActiveMQ的几种存储模式选择

* AMQ消息存储 \(默认的消息存储\)  基于文件存储的消息数据库，不依赖于第三方数据库

* KahaDB 消息存储\(提供容量的提升和恢复能力\) 基于文件支持事务的消息存储器，是一个可靠，高性能，可扩展的消息存储器

* 消息存储机制

* JDBC 消息存储\(消息基于JDBC存储\)

* 使用Mysql或Oracle数据库存储消息

* Memory 消息存储\(基于内容的消息存储\)  ActiveMQ支持将消息保存到内存中，将Broker的“prsistent” 属性设置为“false”。



